<!--
@license
Copyright (c) 2015 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<!--
`<demo-navigation>` is a helper element for navigating the demo files of a
vaadin element.

Configure the menu items using a comon javascript array of objects.
Each object must have a `name` field which matches the demo file `name.html`.
Optionally you can specify the title, otherwise the name is used.

```
window.demos = [
  {name: 'index', title: 'Data'},
  {name: 'formatting'},
];
```

Then, just include the component in each demo page.

```
 <demo-navigation></demo-navigation>
```
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../vaadin-icons/vaadin-icons.html">

<dom-module id="demo-navigation">
  <template>
    <style>
      :host {
        display: flex;
        flex-direction: column;
        padding: 8px 24px 64px;
        font-size: var(--demo-navigation-font-size, 0.875em);
        position: fixed;
        z-index: 10;
        left: 0;
        top: 0;
        width: var(--demo-navigation-width);
        box-sizing: border-box;
        height: 100vh;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
        outline: none;
        background-color: var(--demo-navigation-sidebar-background-color, rgba(0,0,0,0.02));
      }

      .header {
        outline: none;
        font-size: 1.5em;
        margin: 0.5em 0;
      }

      nav {
        flex-grow: 1;
      }

      nav ul {
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        list-style: none;
      }

      nav li {
        display: block;
      }

      .title {
        padding: 4px 0;
      }

      nav a {
        text-decoration: none;
        color: inherit;
        opacity: 0.6;
        display: block;
      }

      nav a:hover {
        opacity: 1;
      }

      nav .current .title {
        font-weight: 600;
        color: var(--demo-navigation-selected-item-color, blue);
      }

      nav .current .title::before {
        content: "â€º";
        position: absolute;
        margin-left: -1em;
      }

      nav .current .sections:not(:empty) {
        margin-top: 8px;
        margin-bottom: 16px;
      }

      nav .current .sections {
        border-left: var(--demo-navigation-current-section-border, 2px solid rgba(0,0,0,0.1));
      }

      nav .current .sections a {
        display: block;
        font-weight: 400;
        margin: 8px 0;
        padding: 0;
        margin-left: 1em;
      }

      nav .current .sections a:target {
        opacity: 1;
        color: #000;
      }

      nav .group h4 {
        font-size: 0.875em;
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.03em;
        margin: 1.8em 0 0.5em;
      }

      @media screen and (max-width: 800px) {
        :host {
          max-width: none;
          width: 100%;
          padding: 0;
          overflow: visible;
          -webkit-overflow-scrolling: none;
          pointer-events: none;
          background-color: transparent;
        }

        .header {
          padding: 16px;
          padding-left: 48px;
          margin: 0;
          box-shadow: inset 0 -1px 0 0 rgba(0,0,0,0.1), 0 2px 5px rgba(0,0,0,0.1);
          min-height: 32px;
          line-height: 32px;
          pointer-events: auto;
          -webkit-tap-highlight-color: transparent;
          background-color: var(--demo-navigation-header-background-color, #fff);
        }

        .header::before {
          position: absolute;
          top: 26px;
          left: 16px;
          content: "";
          width: 20px;
          height: 2px;
          background-color: #000;
          box-shadow: 0 5px 0 0 #000, 0 10px 0 0 #000;
        }

        .curtain {
          content: "";
          position: absolute;
          top: 0;
          right: 0;
          left: 0;
          bottom: 0;
          background-color: #000;
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.2s;
        }

        ::slotted(*) {
          pointer-events: none;
        }

        nav {
          background-color: #fff;
          transform: translateX(-110%);
          position: absolute;
          top: 0;
          bottom: 0;
          left: 0;
          z-index: 2;
          padding: 8px 24px 64px;
          transition: transform 0.2s 0.1s;
          will-change: transform;
          overflow: auto;
          -webkit-overflow-scrolling: touch;
          box-shadow: 2px 0 10px rgba(0,0,0,0.2);
          max-width: 90%;
          pointer-events: auto;
          width: var(--demo-navigation-width);
        }

        .header:focus + nav {
          transform: translateX(0);
          transition-delay: 0s;
        }

        .header:focus ~ .curtain {
          opacity: 0.2;
          pointer-events: auto;
        }

        .header:focus {
          pointer-events: none;
        }
      }
    </style>

    <div class="header" tabindex="-1">
      <slot name="header"></slot>
    </div>
    <nav>
      <ul class="layout horizontal wrap">
        <template is="dom-repeat" items="[[items]]">
          <template is="dom-if" if="[[_group(item)]]">
            <li class="group"><h4>[[_group(item)]]</h4></li>
          </template>
          <template is="dom-if" if="[[_current(item)]]">
            <li class="current"><div class="title">[[_title(item)]]</div></li>
          </template>
          <template is="dom-if" if="[[!_current(item)]]">
            <li><a class="title" href="[[item.name]].html">[[_title(item)]]</a></li>
          </template>
        </template>
      </ul>
    </nav>
    <div class="curtain"></div>
    <slot name="footer"></slot>
  </template>
  <script>
    Polymer({
      properties: {
        items: {
          type: Array,
          value: function() {
            return window.demos;
          }
        }
      },

      is: 'demo-navigation',

      _current: function(item) {
        var url = window.location.pathname;
        var filename = url.substring(url.lastIndexOf('/') + 1) || 'index.html';
        return filename.replace(/\.[^.]+$/, '') === item.name;
      },

      _title: function(item) {
        return item.title || item.name;
      },

      _group: function(item) {
        return item.group;
      },

      attached: function() {
        var currentSections = "";

        this.tabIndex = -1;

        [].forEach.call(document.querySelectorAll('[demo-section]'), function(demoSection) {
          var id = demoSection.textContent.toLowerCase().replace(/[^\w]+/g, '-');
          var hash = '#' + id;

          // Link on the page
          var a = document.createElement('a');
          a.innerHTML = '<iron-icon icon="vaadin:link"></iron-icon>';
          a.classList.add('anchor');
          a.href = hash;
          a.id = id;
          a.setAttribute('aria-hidden', true);
          demoSection.insertBefore(a, demoSection.firstChild);

          // Link in the menu
          var a = a.cloneNode();
          a.textContent = demoSection.textContent;
          a.removeAttribute("id");
          currentSections += a.outerHTML;

          if (window.location.hash == hash) {
            setTimeout(function() {
              demoSection.scrollIntoView();
            }, 500);
          }
        });

        setTimeout(function() {
          this.root.querySelector(".current").innerHTML += '<div class="sections">' + currentSections + '</div>';
        }.bind(this), 100);
      }
    });
  </script>
</dom-module>

<custom-style>
  <style is="custom-style">
    html {
      --demo-navigation-width: 220px;
    }

    [demo-section] .anchor {
      opacity: 0;
      position: absolute;
      transform: translate(-100%, -5%);
      will-change: opacity;
      color: inherit;
      padding-right: 0.3em;
      --iron-icon-width: 16px;
      transition: opacity 0.2s 0.3s;
      outline: none;
      background: transparent;
    }

    [demo-section]:hover .anchor {
      opacity: 0.3;
      transition-delay: 0s;
    }

    [demo-section]:hover .anchor:hover,
    [demo-section] .anchor:focus {
      opacity: 1;
      transition-delay: 0s;
    }

    [demo-section] .anchor:target {
      outline: none;
    }

    body {
      padding-left: var(--demo-navigation-width);
    }

    @media screen and (max-width: 800px) {
      body {
        padding-left: 0;
        padding-top: 64px;
      }
    }
  </style>
</custom-style>
